import{bk as se,l as S,a as w,b as u,d as c,k as h,aH as ae,f as e,t as P,n as $,F as N,b1 as te,aF as oe,o as ne,e as s,u as re,w as p,Z as ie,g as b,i as R,aE as ue,O as ce}from"./vue.m-BoM48gZa.js";import{A as me}from"./AuthenticatedLayout-Di-2FOMO.js";import{_ as v}from"./InputError-siFCQWKO.js";import{_ as F}from"./InputLabel-fjeUReQI.js";import{L as de}from"./LoadingModal-BiCFBVY5.js";import{g as _e,s as pe}from"./Ajax-ltBwR52q.js";import{_ as k}from"./TextInput-lN6ApOBV.js";import{_ as fe}from"./FooterButtons-DwrU-TYt.js";import{_ as T,g as ve}from"./FileInput-DhgWzvt4.js";import{_ as q}from"./DeleteButton-CmFOYZ2N.js";import{_ as j}from"./CancelButton-CYN4UORr.js";import{R as ge}from"./ResponsiveTable-D6b5B55q.js";import{I as G}from"./InputDescription-CYIYYTfy.js";import{_ as he}from"./SubButton-BQXSgC_f.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BaseButton-CVzmqfRt.js";const xe={key:0,class:"text-center"},be={key:0,class:"fa fa-times text-red-600"},ye={__name:"ColorPalette",props:{colorCode:{type:String,default:"#FFFFFF"},size:{type:Number,default:20}},setup(f){const d=f,g=se(d).colorCode,x=S(()=>{const i=a.value===!0?"1px solid #ccc":"none",m=a.value===!0?g.value:"#FFFFFF",D=w(d.size);return{border:i,backgroundColor:m,width:`${D.value}px`,height:`${D.value}px`}}),a=S(()=>/^#[0-9a-f]{6}$/i.test(g.value));return(i,m)=>(u(),c("div",{class:"",style:ae(x.value)},[a.value?h("",!0):(u(),c("div",xe,[a.value?h("",!0):(u(),c("i",be))]))],4))}},Ce={key:0},Fe={class:"mr-1.5"},ke={key:0},we=["href"],$e={key:1,class:"py-1 text-xs"},De={key:0,class:"pl-1"},Ve={class:"mr-1.5"},z={__name:"FileInfo",props:{originalFilename:{type:String,default:""},url:{type:String,default:""},file:{type:File,default:null}},emits:["delete-file","clear-file"],setup(f,{emit:d}){const y=d,g=()=>{y("delete-file")},x=()=>{y("clear-file")};return(a,i)=>(u(),c(N,null,[f.originalFilename?(u(),c("div",Ce,[e("span",Fe,P(f.originalFilename),1),f.url?(u(),c("span",ke,[e("a",{href:f.url,class:"text-indigo-600 hover:underline text-xs py-1 text-nowrap",target:"_blank"},"確認",8,we),e("a",{href:"#",class:"text-red-600 ml-1.5 text-nowrap",onClick:$(g,["prevent"])},"削除")])):h("",!0)])):h("",!0),f.file?(u(),c("div",$e,[f.originalFilename?(u(),c("div",De,"↓")):h("",!0),e("span",Ve,P(f.file.name),1),e("a",{href:"#",class:"text-yellow-700 text-nowrap",onClick:$(x,["prevent"])},"クリア")])):h("",!0)],64))}},U={__name:"DragAndDrop",emits:["drop"],setup(f,{emit:d}){const y=d;let g=w(0);const x=S(()=>g.value>0),a=S(()=>x.value===!0?["bg-gray-100","border-dashed","border-2","border-gray-400"]:[]),i=()=>{g.value++},m=()=>{g.value--},D=V=>{g.value=0,y("drop",V)};return(V,M)=>(u(),c("div",{class:oe(a.value),onDragenter:$(i,["prevent"]),onDragleave:$(m,["prevent"]),onDrop:$(D,["prevent"]),onDragover:M[0]||(M[0]=$(()=>{},["prevent"]))},[te(V.$slots,"default")],34))}},Se=e("h2",{class:"font-semibold text-indigo-50 leading-tight"},"素材の追加・編集",-1),Me={class:"sm:py-6"},Ne={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Te={class:"bg-white overflow-hidden shadow-sm"},ze={class:"p-5 sm:p-10 text-gray-900"},Ue={class:"container mx-auto mb-5"},Ae={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6 mb-5"},Ie={class:"p-0"},Be={class:"p-0"},Ee={class:"text-gray-500"},Ke={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6 mb-5"},Le={class:"mb-5"},Oe={class:"flex items-center"},Pe={class:"mr-2 mb-1"},Re={key:0,class:"text-xs"},qe=e("div",{class:"w-full"},null,-1),je={class:"mb-5"},Ge={class:"flex"},He={class:"flex-grow"},We={class:"py-0 text-sm mt-0.5"},Ye={class:"overflow-x-auto"},Ze={key:0,class:"table w-full mb-3"},Je=e("thead",{class:"bg-gray-200 text-sm"},[e("tr",null,[e("th",{class:"border px-4 py-2"},"名前"),e("th",{class:"border px-4 py-2"},"カラーコード"),e("th",{class:"border px-4 py-2 w-full"},[b("テクスチャ・ファイル"),e("small",{class:"font-normal text-gray-700"},"（ドロップ可）")]),e("th",{class:"border px-4 py-2"})])],-1),Qe={class:"border p-2 align-top"},Xe={class:"border p-2 align-top"},el={class:"flex"},ll={key:0,class:"flex items-center pr-3"},sl={class:"border text-nowrap"},al={class:"flex items-center"},tl={class:"mr-2"},ol={class:"text-xs"},nl={class:"border p-2 text-nowrap"},rl={class:"mb-5"},il={class:"flex"},ul={class:"flex-grow"},cl={class:"py-0 text-sm mt-0.5"},ml={key:0,class:"table w-full text-sm"},dl=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"border px-4 py-2"},"名前"),e("th",{class:"border px-4 py-2 w-full"},[b("ファイル"),e("small",{class:"font-normal text-gray-700"},"（ドロップ可）")]),e("th",{class:"border px-4 py-2"})])],-1),_l={class:"border p-2 align-top"},pl={class:"border text-nowrap"},fl={class:"flex items-center"},vl={class:"mr-2"},gl={class:"text-xs"},hl={class:"border p-2 text-nowrap"},xl={key:0},Bl={__name:"Input",props:{material:{type:Object,default(){return{}}},materialButtonKeys:{type:Array,default(){return[]}}},setup(f){const d=f,y=S(()=>!d.material.id),g=S(()=>d.material.id),x=w(!1);ne(()=>{if(d.material.id){const t=d.material.specular_map;a.value=d.material,a.value.specular_map={id:_.get(t,"id",null),original_filename:_.get(t,"original_filename",""),filename:_.get(t,"filename",""),url:_.get(t,"url",""),file:null}}});const a=w({name:"",key:"",glossiness:"",specular:"",specular_map:{file:null},colors:[],normal_maps:[],textures:[]}),i=w({}),m=w({colors:[],color_files:[],normal_maps:[],normal_map_files:[],specular_maps:[]}),D=()=>{d.materialButtonKeys.some(o=>a.value.key.startsWith(o))?V():Swal.confirm("normal",'<div class="text-sm">現在の「キー」では販売ページの素材画像が有効になりません。<br>よろしいですか？</div>').then(l=>{l.isConfirmed&&V()})},V=()=>{let t="",o={method:"",url:"",deleting_ids:{}};g.value?(t=route("admin.material.update",{id:d.material.id}),o={_method:"PUT",...a.value,deleting_ids:m.value}):(t=route("admin.material.store"),o={...a.value,deleting_ids:m.value}),Swal.confirm().then(l=>{if(l.isConfirmed){x.value=!0;const n=ve(o);axios.post(t,n).then(r=>{r.data.result===!0&&(a.value=r.data.material,i.value={},m.value={colors:[],color_files:[],normal_maps:[],normal_map_files:[],specular_maps:[]},C.value=!1,Swal.success().then(()=>{y.value===!0&&location.reload()}))}).catch(r=>{if(r.response.status===413){alert("送信ファイルサイズが大きすぎます。");return}i.value=_e(r),ue(()=>{pe()})}).finally(()=>x.value=!1)}})},M=()=>{a.value.colors.push({name:"",texture_file:null,color_code:""})},H=(t,o)=>{Swal.confirm("delete").then(l=>{if(l.isConfirmed){const n=t.id;a.value.colors.splice(o,1),n&&(C.value=!0,m.value.colors.push(n))}})},A=(t,o)=>{const l=t.target.files[0];if(l){const n=a.value.colors[o];n.texture_file=l}},W=(t,o)=>{const l=t.dataTransfer.files[0];l&&A({target:{files:[l]}},o)},Y=t=>{Swal.confirm("delete").then(o=>{if(o.isConfirmed){const l=a.value.colors[t];l.id&&(m.value.color_files.push(l.id),m.value.color_files=_.uniq(m.value.color_files),l.original_texture_filename="",l.texture_filename="",I(t),C.value=!0)}})},I=t=>{a.value.colors[t].texture_file=null},Z=()=>{a.value.normal_maps.push({name:"",file:null})},J=(t,o)=>{Swal.confirm("delete").then(l=>{if(l.isConfirmed){const n=t.id;a.value.normal_maps.splice(o,1),n&&(C.value=!0,m.value.normal_maps.push(t.id))}})},B=(t,o)=>{const l=t.target.files[0];if(l){const n=a.value.normal_maps[o];n.file=l}},Q=(t,o)=>{const l=t.dataTransfer.files[0];l&&B({target:{files:[l]}},o)},X=t=>{Swal.confirm("delete").then(o=>{if(o.isConfirmed){const l=a.value.normal_maps[t];l.id&&(m.value.normal_map_files.push(l.id),m.value.normal_map_files=_.uniq(m.value.normal_map_files),l.original_filename="",l.filename="",E(t),C.value=!0)}})},E=t=>{a.value.normal_maps[t].file=null},K=t=>{const o=t.target.files[0];o&&(a.value.specular_map.file=o)},ee=t=>{Swal.confirm("delete").then(o=>{o.isConfirmed&&(m.value.specular_maps.push(t),a.value.specular_map.original_filename="",a.value.specular_map.filename="",L(),C.value=!0)})},L=()=>{a.value.specular_map.file=null},C=w(!1),le=()=>{let t="";d.materialButtonKeys.forEach((o,l)=>{t+=`<div class="text-base text-left">・${o}`,l===0&&(t+=`<small>（例：${o}<strong>abc</strong>）</small>`),t+="</div>"}),Swal.fire({title:"以下から始まる文字列は画像が有効になります。",html:t,icon:"info",confirmButtonText:"OK"})},O=()=>{ce.visit(route("admin.material.index"))};return(t,o)=>(u(),c(N,null,[s(re(ie),{title:"素材の追加・編集"}),s(me,null,{header:p(()=>[Se]),default:p(()=>[e("div",Me,[e("div",Ne,[e("div",Te,[e("div",ze,[e("div",Ue,[e("div",Ae,[e("div",Ie,[s(F,{value:"素材名"}),s(k,{type:"text",name:"name",class:"mt-1 block w-full",modelValue:a.value.name,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value.name=l)},null,8,["modelValue"]),s(v,{message:i.value.name},null,8,["message"])]),e("div",Be,[s(F,{value:"キー",subTitle:"（空白は不可）"}),s(k,{type:"text",name:"name",class:"mt-1 block w-full",modelValue:a.value.key,"onUpdate:modelValue":o[1]||(o[1]=l=>a.value.key=l)},null,8,["modelValue"]),s(v,{message:i.value.key},null,8,["message"]),e("div",Ee,[e("small",null,[b(" ※"),e("a",{href:"#",onClick:$(le,["prevent"])},"画像が有効になるキーのサンプル")])])])]),e("div",Ke,[e("div",null,[s(F,{value:"光沢度","sub-title":"（Glossiness）"}),s(k,{type:"text",name:"glossiness",class:"mt-1 block w-full",modelValue:a.value.glossiness,"onUpdate:modelValue":o[2]||(o[2]=l=>a.value.glossiness=l)},null,8,["modelValue"]),s(G,null,{default:p(()=>[b(" 範囲は0~1。少数第3位まで（例：0.047） ")]),_:1}),s(v,{message:i.value.glossiness},null,8,["message"])]),e("div",null,[s(F,{value:"鏡面反射","sub-title":"（Specular）"}),s(k,{type:"text",name:"specular",class:"mt-1 block w-full",modelValue:a.value.specular,"onUpdate:modelValue":o[3]||(o[3]=l=>a.value.specular=l)},null,8,["modelValue"]),s(G,null,{default:p(()=>[b(" 範囲は0~1。少数第3位まで（例：0.047） ")]),_:1}),s(v,{message:i.value.specular},null,8,["message"])])]),e("div",Le,[e("div",null,[s(F,{value:"鏡面反射画像","sub-title":"（Specular Map）"}),s(U,{onDrop:K},{default:p(()=>[e("div",Oe,[e("div",Pe,[s(T,{onChange:K})]),a.value.specular_map?(u(),c("div",Re,[s(z,{"original-filename":a.value.specular_map.original_filename,url:a.value.specular_map.url,file:a.value.specular_map.file,onDeleteFile:o[4]||(o[4]=l=>ee(a.value.specular_map.id)),onClearFile:L},null,8,["original-filename","url","file"])])):h("",!0)])]),_:1}),s(v,{message:i.value.specular_map},null,8,["message"])]),qe])]),e("div",je,[e("div",Ge,[e("div",He,[s(F,{value:"カラー","sub-title":`（${a.value.colors.length}件）`},null,8,["sub-title"])]),e("div",We,[s(j,{size:"xs",class:"mb-1",onClick:M},{default:p(()=>[b("追加する")]),_:1})])]),e("div",Ye,[a.value.colors.length>0?(u(),c("table",Ze,[Je,e("tbody",null,[(u(!0),c(N,null,R(a.value.colors,(l,n)=>(u(),c("tr",{key:n},[e("td",Qe,[s(k,{type:"text",class:"w-64",modelValue:l.name,"onUpdate:modelValue":r=>l.name=r},null,8,["modelValue","onUpdate:modelValue"]),s(v,{message:i.value[`colors.${n}.name`]},null,8,["message"])]),e("td",Xe,[e("div",el,[l.color_code?(u(),c("div",ll,[s(ye,{size:20,"color-code":l.color_code},null,8,["color-code"])])):h("",!0),e("div",null,[s(k,{type:"text",class:"w-40",modelValue:l.color_code,"onUpdate:modelValue":r=>l.color_code=r,placeholder:"例: #FFFFFF"},null,8,["modelValue","onUpdate:modelValue"])])]),s(v,{message:i.value[`colors.${n}.color_code`]},null,8,["message"])]),e("td",sl,[s(U,{class:"p-3",onDrop:r=>W(r,n)},{default:p(()=>[e("div",al,[e("div",tl,[s(T,{onChange:r=>A(r,n)},null,8,["onChange"])]),e("div",ol,[s(z,{"original-filename":l.original_texture_filename,url:l.texture_url,file:l.texture_file,onDeleteFile:r=>Y(n),onClearFile:r=>I(n)},null,8,["original-filename","url","file","onDeleteFile","onClearFile"])])]),s(v,{message:i.value[`colors.${n}.texture_file`]},null,8,["message"])]),_:2},1032,["onDrop"])]),e("td",nl,[s(q,{size:"xs",onClick:r=>H(l,n)},{default:p(()=>[b("削除")]),_:2},1032,["onClick"])])]))),128))])])):h("",!0),s(v,{message:i.value.colors},null,8,["message"])])]),e("div",rl,[e("div",il,[e("div",ul,[s(F,{value:"ノーマルマップ","sub-title":`（${a.value.normal_maps.length}件）`},null,8,["sub-title"])]),e("div",cl,[s(j,{size:"xs",class:"mb-1",onClick:Z},{default:p(()=>[b("追加する")]),_:1})])]),s(ge,null,{default:p(()=>[a.value.normal_maps.length>0?(u(),c("table",ml,[dl,e("tbody",null,[(u(!0),c(N,null,R(a.value.normal_maps,(l,n)=>(u(),c("tr",{key:n},[e("td",_l,[s(k,{type:"text",name:"`normal_maps[${index}][name]`",class:"w-64",modelValue:l.name,"onUpdate:modelValue":r=>l.name=r},null,8,["modelValue","onUpdate:modelValue"]),s(v,{message:i.value[`normal_maps.${n}.name`]},null,8,["message"])]),e("td",pl,[s(U,{class:"p-3",onDrop:r=>Q(r,n)},{default:p(()=>[e("div",fl,[e("div",vl,[s(T,{onChange:r=>B(r,n)},null,8,["onChange"])]),e("div",gl,[s(z,{"original-filename":l.original_filename,url:l.url,file:l.file,onDeleteFile:r=>X(n),onClearFile:r=>E(n)},null,8,["original-filename","url","file","onDeleteFile","onClearFile"])])]),s(v,{message:i.value[`normal_maps.${n}.file`]},null,8,["message"])]),_:2},1032,["onDrop"])]),e("td",hl,[s(q,{size:"xs",onClick:r=>J(l,n)},{default:p(()=>[b("削除")]),_:2},1032,["onClick"])])]))),128))])])):h("",!0),s(v,{message:i.value.normal_maps},null,8,["message"])]),_:1})])])])])]),s(fe,{"is-preparing":C.value,onYesClick:D,onNoClick:O},{left:p(()=>[s(he,{size:"md",href:t.route("admin.material.input"),onClick:O},{default:p(()=>[b("新規追加")]),_:1},8,["href"])]),_:1},8,["is-preparing"]),x.value?(u(),c("div",xl,[s(de,{show:x.value},null,8,["show"])])):h("",!0)]),_:1})],64))}};export{Bl as default};
