import{l as h,b as p,d as f,k as $,t as z,f as o,aF as Z,aH as we,b1 as Ce,g as L,e as B,w as E,F as P,o as le,a as N,bC as Se,u as V,Z as Me,i as q,n as K,X as F,bP as W,bS as X,aE as $e,aX as Be,aU as Ie}from"./vue.m-BoM48gZa.js";import{_ as Ne}from"./BaseButton-CVzmqfRt.js";import{_ as Pe}from"./GuestLayout-BLXmUMDc.js";import{L as Te}from"./LoadingModal-BiCFBVY5.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"min-w-[160px] w-[160px] h-[80px] relative flex items-center justify-center"},Ee={key:0,src:"/images/material-selected.png",style:{width:"152px",height:"68px","margin-top":"-3px","margin-left":"-2px","mask-image":"radial-gradient(circle, #000 75%, transparent 100%)"},class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-0 opacity-85",alt:"Selected background"},Le=["src","alt"],je={__name:"MaterialButton",props:{material:{type:Object},selected:{type:Boolean,default:!1}},emits:["click"],setup(l,{emit:c}){const n=l,g=c,m=h(()=>n.material.button_image_url),v=h(()=>n.material.key),i=()=>{g("click",{material:n.material})};return(u,a)=>(p(),f("div",ze,[l.selected?(p(),f("img",Ee)):$("",!0),m.value?(p(),f("img",{key:1,src:m.value,class:"w-full h-full cursor-pointer p-2 relative z-10",alt:v.value,onClick:i},null,8,Le)):(p(),f("button",{key:2,type:"button",class:"flex items-center justify-center border rounded-lg w-[136px] h-[56px] mb-[7px] mr-1 bg-main-500 text-main-50 z-10 opacity-95",onClick:i},z(v.value),1))]))}},Ke={class:"relative"},Re={key:0,src:"/images/color-selected.png",style:{width:"63px",height:"63px","mask-image":"radial-gradient(circle, #000 70%, transparent 100%)"},class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-0 opacity-80",alt:"Selected background"},Ae=["color-id","color-name","type"],De={__name:"ColorButton",props:{color:{type:Object},selected:{type:Boolean,default:!1}},emits:["click"],setup(l,{emit:c}){const n=l,g=c,m=h(()=>{const C="p-6 shadow-md cursor-pointer relative m-2";return u.value==="color_code"?`${C} bg-[${i.value}]`:C}),v=h(()=>{let C={borderRadius:"21%"};return u.value==="texture"&&(C={...C,backgroundImage:`url(${n.color.small_texture_url})`,backgroundSize:"cover",backgroundPosition:"center"}),C}),i=h(()=>n.color.color_code),u=h(()=>n.color.texture_url?"texture":"color_code"),a=h(()=>n.color.id),x=h(()=>n.color.name),M=()=>{g("click",{color:n.color})};return(C,J)=>(p(),f("div",Ke,[l.selected?(p(),f("img",Re)):$("",!0),o("div",{class:Z([m.value,"relative z-10"]),style:we(v.value),"color-id":a.value,"color-name":x.value,type:u.value,onClick:M},null,14,Ae)]))}},Ue=(l,c)=>new Promise((n,g)=>{let m={};const v=(a,x)=>{m[a]=x,m.api&&m.materials&&m.nodes&&n(m)},i="1.12.1";new window.Sketchfab(i,l).init(c,{ui_infos:0,ui_help:0,ui_settings:0,ui_vr:0,ui_ar:0,ui_inspector:0,ui_fullscreen:0,ui_watermark:0,ui_stop:0,success(a){a.start(),a.addEventListener("viewerready",()=>{v("api",a),a.getMaterialList((x,M)=>{x||v("materials",M)}),a.getNodeMap((x,M)=>{x||v("nodes",M)})})},error(a){g(a)}})}),ne=(l,c,n)=>{const g=[n],m=c.filter(i=>{for(const u in g){const a=g[u];if(i.key===a)return!0}return!1}),v=l.filter(i=>{for(const u in g){const a=g[u];if(i.name===a)return!0}return!1});if(m.length>0){const i=m.map(a=>a.component_group_keys),u=_.flatten(i);return l.filter(a=>u.includes(a.name))}else{if(v.length>0)return v;console.error("指定されたグループが見つかりませんでした: "+n)}return[]},Oe=2.4,H=l=>{var c=0;return l<.04045?l>=0&&(c=l*(1/12.92)):c=Math.pow((l+.055)*(1/1.055),Oe),c},Ve=(l,c)=>{var n=c||new Array(l.length);if(l.length>2&&l.length<5)n[0]=H(l[0]),n[1]=H(l[1]),n[2]=H(l[2]),n.length>3&&l.length>3&&(n[3]=l[3]);else throw new Error("Invalid color. Expected 3 or 4 components, but got "+l.length);return n},qe=l=>{var c=l.match(/^#([0-9a-f]{6})$/i);if(c)return[parseInt(c[1].substr(0,2),16)/255,parseInt(c[1].substr(2,2),16)/255,parseInt(c[1].substr(4,2),16)/255];throw new Error("Invalid color: "+l)},Fe=l=>Ve(qe(l)),We={class:"flex items-center justify-center tracking-wider text-sm"},re={__name:"BaseButton",props:{size:{type:String,default:"md"},selected:{type:[Boolean,null],default:null}},emits:["click"],setup(l,{emit:c}){const n=l,g=c,m=h(()=>{const i=["border","font-serif","rounded-none","transition","duration-300","ease-in-out","hover:shadow-lg","focus:outline-none","focus:ring-2","focus:ring-[#D4AF37]","focus:ring-opacity-50"],u={selected:["bg-main-800","hover:bg-main-700","text-main-50","hover:text-main-100","border-none"],unselected:["bg-main-300","hover:bg-main-400","text-main-900","hover:text-main-800","border-none"]},a=n.selected===!1?u.unselected:u.selected,x={sm:["text-xs","py-1","px-3"],md:["text-sm","py-2","px-5"],lg:["text-base","py-3","px-7"]},M=x[n.size]||x.md;return[...i,...a,...M]}),v=()=>{g("click")};return(i,u)=>(p(),f("button",{class:Z(["bg-black text-white text-xs px-3 py-1 cursor-pointer hover:opacity-80 focus:outline-none font-shippori",m.value]),onClick:v},[o("span",We,[Ce(i.$slots,"default",{},()=>[L("送信する")])])],2))}},Xe={__name:"YesNoButtons",props:{size:{type:String,default:"md"},selected:{type:[Boolean,null],default:null}},emits:["change"],setup(l,{emit:c}){const n=l,g=c,m=h(()=>n.selected===!0),v=h(()=>n.selected===!1),i=u=>{g("change",{value:u})};return(u,a)=>(p(),f(P,null,[B(re,{size:"md",selected:m.value,onClick:a[0]||(a[0]=x=>i(!0))},{default:E(()=>[L("あり")]),_:1},8,["selected"]),B(re,{size:"md",selected:v.value,onClick:a[1]||(a[1]=x=>i(!1))},{default:E(()=>[L("なし")]),_:1},8,["selected"])],64))}},He={class:"flex items-center"},Y={__name:"VerticalSeparator",props:{height:{type:String,default:"h-6"}},setup(l){const c=l,n=h(()=>c.height);return(g,m)=>(p(),f("div",He,[o("div",{class:Z(["inline-block border-r border-main-300 mx-auto",n.value])},null,2)]))}},S=l=>(Be("data-v-e2656b01"),l=l(),Ie(),l),Ye={class:"w-full min-h-auto flex flex-col mt-[20px]"},Ze={class:"sm:w-[93%] lg:w-[100%] max-w-[1280px] mx-auto lg:px-7"},Je={class:"flex justify-between"},Qe={class:"text-base font-bold underline font-shippori text-main-700 md:pl-0.5"},et={class:"flex flex-col"},tt=S(()=>o("i",{class:"fas fa-chevron-right ml-2"},null,-1)),st={class:"text-md border-b border-main-700 font-shippori"},ot={class:"sm:w-[93%] lg:w-[100%] max-w-[1280px] mx-auto lg:px-8 mb-32 lg:mb-0 mt-4 text-xs md:text-base"},lt={class:"relative"},nt=S(()=>o("div",{class:"w-3/5 mx-auto min-h-full flex-col"},[o("div",{class:"w-full bg-gray-100"},[o("iframe",{src:"",id:"api-frame",class:"w-full h-32 sm:h-60 md:h-80 lg:h-96",allow:"autoplay; fullscreen; xr-spatial-tracking","xr-spatial-tracking":"","execution-while-out-of-viewport":"","execution-while-not-rendered":"","web-share":"",allowfullscreen:"",mozallowfullscreen:"true",webkitallowfullscreen:"true"})])],-1)),rt={class:"absolute w-2/5 top-0"},at={class:"flex flex-col gap-3"},ct={class:"flex flex-col gap-2"},it=S(()=>o("h2",{class:"font-semibold underline mb-1 font-shippori text-main-700"},"PARTS",-1)),ut=["id","checked","onChange"],dt=["for"],mt=S(()=>o("div",{class:"absolute right-0 top-8 sm:top-24 md:top-36 lg:top-44 w-1/5 flex mb-5 flex-col items-end justify-center"},[o("img",{src:"/images/controller.svg",class:"h-[100px] opacity-50"})],-1)),pt={class:"flex flex-col items-center justify-center gap-2 mt-6 mb-10"},ft={class:"flex justify-center"},ht={class:"py-0.5 px-2 bg-main-500 opacity-65 text-xs sm:text-sm text-white rounded text-center font-bold font-shippori shadow-md"},_t={class:"w-full"},gt=S(()=>o("h2",{class:"underline text-main-800 mb-3 text-center font-shippori font-bold"},"素材",-1)),vt={class:"w-full flex items-center justify-center gap-5"},xt=S(()=>o("img",{src:"/images/scroll-left.svg",class:"h-5"},null,-1)),yt=[xt],bt={id:"material-section",class:"flex items-center gap-8 overflow-x-auto whitespace-nowrap hide-scrollbar w-full"},kt={key:0,class:"text-sm text-center w-full text-gray-500",style:{"font-family":"'Shippori Micho', serif"}},wt=S(()=>o("img",{src:"/images/scroll-right.svg",class:"h-5"},null,-1)),Ct=[wt],St={key:2,class:"w-full"},Mt=S(()=>o("h2",{class:"underline text-main-800 mb-3 text-center font-shippori font-bold"},"革色",-1)),$t={class:"w-full flex items-center justify-center gap-8"},Bt=S(()=>o("img",{src:"/images/scroll-left.svg",class:"h-5"},null,-1)),It=[Bt],Nt={id:"color-section",class:"flex items-center gap-6 overflow-x-auto whitespace-nowrap hide-scrollbar w-full pb-4"},Pt={key:0,class:"text-sm text-center w-full text-gray-500",style:{"font-family":"'Shippori Micho', serif"}},Tt=S(()=>o("img",{src:"/images/scroll-right.svg",class:"h-5"},null,-1)),Gt=[Tt],zt={key:4,class:"w-full flex items-center justify-center gap-2"},Et={__name:"Show",props:{product:{type:Object},materialCombinationGroups:{type:Array}},setup(l){const c=l,n=c.product,g=c.materialCombinationGroups,m=n.material_combination.groups;le(()=>{const e=document.getElementById("api-frame"),t=n.sketchfab_model_key;Ue(e,t).then(M)});const v=e=>{const t=document.getElementById(e);t&&t.scrollTo({left:0})},i=(e,t)=>{const s=document.getElementById(e),r=150,d=s.scrollWidth-s.clientWidth;t==="left"&&s.scrollLeft>0?s.scrollBy({left:-r,behavior:"smooth"}):t==="right"&&s.scrollLeft<d&&s.scrollBy({left:r,behavior:"smooth"})};let u={},a=[],x=[];const M=e=>{u=e.api,a=e.materials,x=e.nodes},C=N(!1),J=N(""),ae=()=>{W.confirm("normal","この内容で確定してもよろしいですか？").then(e=>{if(e.isConfirmed){C.value=!0,J.value="";const t=route("store.product.store"),s={productId:n.id,components:w.value};X.post(t,s).then(r=>{if(r.data.result===!0){const d=r.data.order_unique_id;window.location.href=route("store.product.complete",{orderUniqueId:d})}}).catch(r=>{const d=r.response.data.errors,b=[];for(const k in d){const U=d[k];for(const O of U)b.push(`・${O}`)}W.fire({title:"入力エラー",html:`<div class="text-left text-sm">${b.join("<br>")}</div>`,icon:"error"})}).finally(()=>{C.value=!1})}})},ce=h(()=>`${n.name} - ${n.material_combination.label}`),y=N(""),I=N(""),ie=h(()=>{const e=m.find(t=>t.key===y.value);return _.get(e,"label","")}),ue=e=>{const t=e.key,s=e.required_inputs;v("material-section"),y.value=t,s.includes("color_id")&&!s.includes("material_id")&&ee({material:{id:e.materials[0].id,key:e.materials[0].key}})};le(()=>{y.value=m[0].key});const w=N((()=>{let e={};return m.forEach(t=>{const s="",r="";e[t.key]={material:s,color:r,componentGroupKeys:t.component_groups,logo:null}}),e})()),de=h(()=>{const e=y.value;return _.get(w.value,`${e}.material.id`,"")}),me=h(()=>{const e=y.value;return _.get(w.value,`${e}.color.id`,"")});let R=[];const T=e=>{u.setMaterial(e,t=>{t&&console.error("Error setting material:",t)})},Q=(e,t)=>{R.find(r=>r.url===e)||R.push({url:e,uid:t})},pe=(e,t)=>{t&&(e.channels.GlossinessPBR.enable=!0,e.channels.GlossinessPBR.factor=t)},fe=(e,t)=>{t&&(e.channels.SpecularPBR.enable=!0,e.channels.SpecularPBR.factor=t)},he=(e,t)=>{const s=e.instanceID;t===!0?u.show(s,r=>{r&&console.error("Error showing node:",r)}):u.hide(s,r=>{r&&console.error("Error showing node:",r)})},_e=(e,t)=>{const s=_.get(e,"channels.NormalMap",null);e.channels.NormalMap={...s,enable:!1,texture:null},t&&s?A(t).then(r=>{e.channels.NormalMap.enable=!0,e.channels.NormalMap.texture={uid:r},T(e)}):T(e)},ge=(e,t)=>{const s=_.get(e,"channels.SpecularPBR",null);e.channels.SpecularPBR={...s,enable:!1,texture:null},t&&s?A(t).then(r=>{e.channels.SpecularPBR.enable=!0,e.channels.SpecularPBR.texture={uid:r},T(e)}):T(e)},A=e=>new Promise((t,s)=>{const r=R.find(d=>d.url===e);r?(Q(e,r.uid),t(r.uid)):u.addTexture(e,(d,b)=>{d&&s(d),Q(e,b),t(b)})});let ve={};const ee=e=>{D();const t=y.value,s=e.material.id,r=e.material.key;w.value[t].material={id:s,key:r},w.value[y.value].color=null;const d=j.value.find(b=>b.key===e.material.key);d&&ne(a,g,t).forEach(k=>{pe(k,d.glossiness),fe(k,d.specular);const U=_.get(d,"normal_map.url",null);_e(k,U);const O=_.get(d,"specular_map.url",null);ge(k,O)}),v("color-section")},j=h(()=>{const e=n.material_combination.groups.find(t=>t.key===y.value);return e?e.materials:[]}),te=(e,t)=>{e.channels.DiffusePBR={...e.channels.DiffusePBR,...t},T(e)},xe=e=>{D(),w.value[y.value].color={id:e.color.id,key:e.color.color_code,url:e.color.texture_url};const t=y.value,s=ne(a,g,t),r=w.value[t].material.key;_.set(ve,`${t}.${r}`,e.color),s.forEach(d=>{const b=e.color.texture_url;if(b)A(b).then(k=>{te(d,{color:null,texture:{uid:k}})});else{const k=Fe(e.color.color_code);te(d,{color:k,texture:null})}})},se=h(()=>{const e=j.value.find(t=>t.key===w.value[y.value].material.key);return e?e.colors:[]}),ye=e=>{D();const t=e.value,s=y.value;w.value[s].logo=t;const r=a.find(d=>d.name===s);if(r){const d=r.id,b=Object.values(x).find(k=>k.materialID===d);b&&he(b,t)}},be=h(()=>{const e=y.value;return["Inside_LogoMetal","Outside_LogoMetal"].includes(e)?w.value[e].logo:null}),oe=N({}),D=()=>{$e(()=>{G.value=!0;const e=route("store.product.amounts"),t={productId:n.id,components:w.value};X.post(e,t).then(s=>{oe.value=s.data.amounts}).catch(()=>{W.error("商品の構成にエラーがあるため、合計金額を取得できません。")}).finally(()=>{G.value=!1})})},ke=h(()=>`￥${_.sum(Object.values(oe.value)).toString().replace(/(\d)(?=(\d{3})+$)/g,"$1,")}`),G=N(!1);return Se(()=>y.value,e=>{G.value=!0;const t=route("store.product.group_type",{key:e});X.get(t).then(s=>{I.value=s.data.group_type}).catch(s=>{console.error("Error fetching input type:",s)}).finally(()=>{G.value=!1})}),(e,t)=>(p(),f(P,null,[B(V(Me),{title:V(n).name},null,8,["title"]),B(Pe,null,{default:E(()=>[o("div",Ye,[o("div",Ze,[o("div",Je,[o("h1",Qe,z(ce.value),1),o("div",et,[B(Ne,{size:"md",onClick:ae},{default:E(()=>[L("確定する "),tt]),_:1}),o("div",st,z(ke.value),1)])])]),o("div",ot,[o("div",lt,[nt,o("div",rt,[o("div",at,[o("div",ct,[it,(p(!0),f(P,null,q(V(m),s=>(p(),f("div",{key:s.key,class:"flex items-center gap-2 mb-1"},[o("input",{type:"radio",id:"radio-"+s.key,name:"parts-radio",checked:y.value===s.key,onChange:r=>ue(s),class:"cursor-pointer"},null,40,ut),o("label",{for:"radio-"+s.key,class:"cursor-pointer font-shippori"},z(s.label),9,dt)]))),128))])])]),mt]),B(Te,{show:G.value},{default:E(()=>[L("Loading...")]),_:1},8,["show"]),o("div",pt,[o("div",ft,[o("div",ht,z(ie.value),1)]),I.value==="main"||I.value==="sub"?(p(),f(P,{key:0},[B(Y,{class:"my-2"}),o("div",_t,[gt,o("div",vt,[o("div",null,[o("a",{href:"#",class:"text-sm text-[#808080] p-2",onClick:t[0]||(t[0]=K(s=>i("material-section","left"),["prevent"]))},yt)]),o("div",bt,[(p(!0),f(P,null,q(j.value,s=>(p(),f("div",{class:"relative",key:s.key},[B(je,{material:s,selected:de.value===s.id,onClick:ee},null,8,["material","selected"])]))),128)),j.value.length===0?(p(),f("div",kt," 素材の種類がありません ")):$("",!0)]),o("div",null,[o("a",{href:"#",class:"text-sm text-[#808080] p-2",onClick:t[1]||(t[1]=K(s=>i("material-section","right"),["prevent"]))},Ct)])])])],64)):$("",!0),I.value!=="logo"?(p(),F(Y,{key:1,class:"my-2"})):$("",!0),I.value!=="logo"?(p(),f("div",St,[Mt,o("div",$t,[o("div",null,[o("a",{href:"#",class:"text-sm text-[#808080] p-2",onClick:t[2]||(t[2]=K(s=>i("color-section","left"),["prevent"]))},It)]),o("div",Nt,[(p(!0),f(P,null,q(se.value,s=>(p(),F(De,{key:s.id,color:s,selected:me.value===s.id,onClick:xe},null,8,["color","selected"]))),128)),se.value.length===0?(p(),f("div",Pt," カラーの種類がありません ")):$("",!0)]),o("div",null,[o("a",{href:"#",class:"text-sm text-[#808080] p-2",onClick:t[3]||(t[3]=K(s=>i("color-section","right"),["prevent"]))},Gt)])])])):$("",!0),I.value==="logo"?(p(),F(Y,{key:3,class:"my-2"})):$("",!0),I.value==="logo"?(p(),f("div",zt,[B(Xe,{selected:be.value,onChange:ye},null,8,["selected"])])):$("",!0)])])])]),_:1})],64))}},Ut=Ge(Et,[["__scopeId","data-v-e2656b01"]]);export{Ut as default};
